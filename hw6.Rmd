---
title: "hw6"
author: "Ruihan Zhang"
date: "2022-11-30"
output: github_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(viridis)
library(dplyr)
library(purrr)
library(broom)
library(p8105.datasets)

set.seed(1)

```

```{r}
homicide= read_csv("./data/homicide-data.csv") %>% 
  janitor::clean_names() %>% 
  mutate(city_state = str_c(city,", ",state)) %>% 
  mutate(outcome = case_when(disposition == "Closed without arrest" ~ 'not solved',
                           disposition == 'Closed by arrest' ~ 'solved')
  ) %>% 
  filter(city_state != "Dallas, TX",
         city_state != "Phoenix, AZ",
         city_state != "Kansas City, MO",
         city_state != "Tulsa, AL",
         ) %>% 
  filter(victim_race == "White" | victim_race == "Black") %>% 
  mutate(., victim_age = as.numeric(victim_age))
```

```{r}
Baltimore = homicide %>% 
  filter(city_state == "Baltimore, MD") %>% 
  mutate(outcome = case_when(outcome ==  'not solved' ~ "0",
                           outcome ==  'solved' ~ "1")) %>% 
  mutate(outcome = as.numeric(outcome))
  
```

```{r}
sink("fit.txt")
 fit = glm(formula = outcome~victim_race+victim_age+victim_sex, family = binomial(), data = Baltimore)
 print(fit)
 sink()
```


```{r}
fit %>%  broom::tidy() %>% 
  mutate(OR = exp(estimate)) %>%
  select(term, log_OR = estimate, OR) %>% 
  knitr::kable(digits = 3)
```




